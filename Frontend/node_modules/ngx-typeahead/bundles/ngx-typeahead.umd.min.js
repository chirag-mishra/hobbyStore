!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("rxjs/Subject"),require("rxjs/observable/of"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@angular/common/http","rxjs/Subject","rxjs/observable/of","rxjs/operators"],factory):factory((global.ng=global.ng||{},global.ng.ngxTypeahead={}),global.ng.core,global.ng.common,global.ng.commmon.http,global.Rx,global.Rx.Observable.prototype,global.Rx.Observable.prototype)}(this,function(exports,core,common,http,Subject,of,operators){"use strict";function validateNonCharKeyCode(keyCode){return[Key.Enter,Key.Tab,Key.Shift,Key.ArrowLeft,Key.ArrowUp,Key.ArrowRight,Key.ArrowDown,Key.MacCommandLeft,Key.MacCommandRight,Key.MacCommandFirefox].every(function(codeKey){return codeKey!==keyCode})}function validateArrowKeys(keyCode){return keyCode===Key.ArrowDown||keyCode===Key.ArrowUp}function isIndexActive(index,currentIndex){return index===currentIndex}function isEnterKey(event){return event.keyCode===Key.Enter}function isEscapeKey(event){return event.keyCode===Key.Escape}function createParamsForQuery(query,queryParamKey,customParams){void 0===queryParamKey&&(queryParamKey="q"),void 0===customParams&&(customParams={});var searchParams=__assign((_a={},_a[queryParamKey]=query,_a),customParams);return Object.keys(searchParams).reduce(function(acc,param){return acc.set(param,searchParams[param])},new http.HttpParams);var _a}function resolveApiMethod(method){return void 0===method&&(method=""),["get","post","put","delete","patch","request"].some(function(methodName){return method===methodName})?method:"get"}function resolveNextIndex(currentIndex,stepUp,listLength){void 0===listLength&&(listLength=10);var topLimit=listLength-1,currentResultIndex=currentIndex+(stepUp?1:-1),resultIndex=currentResultIndex;return currentResultIndex===topLimit+1&&(resultIndex=0),-1===currentResultIndex&&(resultIndex=topLimit),resultIndex}function toJsonpSingleResult(response){return response[1]}function toJsonpFinalResults(results){return results.map(function(result){return result[0]})}function hasCharacters(query){return query.length>0}function toFormControlValue(e){return e.target.value}var __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},Key={Backspace:8,Tab:9,Enter:13,Shift:16,Escape:27,ArrowLeft:37,ArrowRight:39,ArrowUp:38,ArrowDown:40,MacCommandLeft:91,MacCommandRight:93,MacCommandFirefox:224};Key[Key.Backspace]="Backspace",Key[Key.Tab]="Tab",Key[Key.Enter]="Enter",Key[Key.Shift]="Shift",Key[Key.Escape]="Escape",Key[Key.ArrowLeft]="ArrowLeft",Key[Key.ArrowRight]="ArrowRight",Key[Key.ArrowUp]="ArrowUp",Key[Key.ArrowDown]="ArrowDown",Key[Key.MacCommandLeft]="MacCommandLeft",Key[Key.MacCommandRight]="MacCommandRight",Key[Key.MacCommandFirefox]="MacCommandFirefox";var NgxTypeAheadComponent=function(){function NgxTypeAheadComponent(element,viewContainer,http$$1,cdr){this.element=element,this.viewContainer=viewContainer,this.http=http$$1,this.cdr=cdr,this.showSuggestions=!1,this.taUrl="",this.taParams={},this.taQueryParam="q",this.taApi="jsonp",this.taApiMethod="get",this.taList=[],this.taDebounce=300,this.taSelected=new core.EventEmitter,this.suggestionIndex=0,this.keydown$=new Subject.Subject,this.keyup$=new Subject.Subject}return NgxTypeAheadComponent.prototype.handleEsc=function(event){isEscapeKey(event)&&(this.hideSuggestions(),event.preventDefault()),this.keydown$.next(event)},NgxTypeAheadComponent.prototype.onkeyup=function(event){event.preventDefault(),event.stopPropagation(),this.keyup$.next(event)},NgxTypeAheadComponent.prototype.ngOnInit=function(){this.filterEnterEvent(this.keydown$),this.listenAndSuggest(this.keyup$),this.navigateWithArrows(this.keydown$),this.renderTemplate()},NgxTypeAheadComponent.prototype.ngOnDestroy=function(){this.keydown$.complete(),this.keyup$.complete()},NgxTypeAheadComponent.prototype.renderTemplate=function(){this.viewContainer.createEmbeddedView(this.suggestionsTplRef),this.cdr.markForCheck()},NgxTypeAheadComponent.prototype.listenAndSuggest=function(obs){var _this=this;return obs.pipe(operators.filter(function(e){return validateNonCharKeyCode(e.keyCode)}),operators.map(toFormControlValue),operators.debounceTime(this.taDebounce),operators.concat(),operators.distinctUntilChanged(),operators.filter(hasCharacters),operators.switchMap(function(query){return _this.suggest(query)})).subscribe(function(results){_this.results=results,_this.suggestionIndex=-1,_this.displaySuggestions(Key.ArrowDown)})},NgxTypeAheadComponent.prototype.filterEnterEvent=function(elementObs){var _this=this;return elementObs.pipe(operators.filter(isEnterKey)).subscribe(function(event){_this.handleSelectSuggestion(_this.activeResult)})},NgxTypeAheadComponent.prototype.navigateWithArrows=function(elementObs){var _this=this;return elementObs.pipe(operators.filter(function(e){return validateArrowKeys(e.keyCode)}),operators.map(function(e){return e.keyCode})).subscribe(function(keyCode){return _this.displaySuggestions(keyCode)})},NgxTypeAheadComponent.prototype.displaySuggestions=function(keyCode){this.suggestionIndex=resolveNextIndex(this.suggestionIndex,keyCode===Key.ArrowDown,this.results.length),this.showSuggestions=!0,this.cdr.markForCheck()},NgxTypeAheadComponent.prototype.suggest=function(query){return this.taList.length?this.createListSource(this.taList,query):this.request(query)},NgxTypeAheadComponent.prototype.request=function(query){var url=this.taUrl,options={params:createParamsForQuery(query,this.taQueryParam,this.taParams)};return"jsonp"===this.taApi?this.requestJsonp(url,options,this.taCallbackParamValue):this.requestHttp(url,options)},NgxTypeAheadComponent.prototype.requestHttp=function(url,options){var apiMethod=resolveApiMethod(this.taApiMethod);return this.http[apiMethod](url,options)},NgxTypeAheadComponent.prototype.requestJsonp=function(url,options,callback){void 0===callback&&(callback="callback");var params=options.params.toString();return this.http.jsonp(url+"?"+params,callback).pipe(operators.map(toJsonpSingleResult),operators.map(toJsonpFinalResults))},NgxTypeAheadComponent.prototype.markIsActive=function(index,result){var isActive=isIndexActive(index,this.suggestionIndex);return isActive&&(this.activeResult=result),isActive},NgxTypeAheadComponent.prototype.handleSelectSuggestion=function(suggestion){this.hideSuggestions(),this.taSelected.emit(suggestion)},NgxTypeAheadComponent.prototype.hideSuggestions=function(){this.showSuggestions=!1},NgxTypeAheadComponent.prototype.hasItemTemplate=function(){return void 0!==this.taItemTpl},NgxTypeAheadComponent.prototype.createListSource=function(list,query){return of.of(list.filter(function(item){return item.includes(query)}))},NgxTypeAheadComponent.decorators=[{type:core.Component,args:[{selector:"[ngxTypeahead]",styles:["\n  .ta-results {\n    position: absolute;\n  }\n  .ta-backdrop {\n    bottom: 0;\n    left: 0;\n    position: fixed;\n    right: 0;\n    top: 0;\n    z-index: 1;\n  }\n  .ta-item {\n    position: relative;\n    z-index: 2;\n    display: block;\n  }\n  "],template:'\n  <ng-template #suggestionsTplRef>\n  <section class="ta-results list-group" *ngIf="showSuggestions">\n    <div class="ta-backdrop" (click)="hideSuggestions()"></div>\n    <button type="button" class="ta-item list-group-item"\n      *ngFor="let result of results; let i = index;"\n      [class.active]="markIsActive(i, result)"\n      (click)="handleSelectSuggestion(result)">\n      <span *ngIf="!taItemTpl"><i class="fa fa-search"></i> {{ result }}</span>\n      <ng-template\n        [ngTemplateOutlet]="taItemTpl"\n        [ngTemplateOutletContext]="{ $implicit: {result: result, index: i} }"\n      ></ng-template>\n    </button>\n  </section>\n  </ng-template>\n  '}]}],NgxTypeAheadComponent.ctorParameters=function(){return[{type:core.ElementRef},{type:core.ViewContainerRef},{type:http.HttpClient},{type:core.ChangeDetectorRef}]},NgxTypeAheadComponent.propDecorators={taItemTpl:[{type:core.Input}],taUrl:[{type:core.Input}],taParams:[{type:core.Input}],taQueryParam:[{type:core.Input}],taCallbackParamValue:[{type:core.Input}],taApi:[{type:core.Input}],taApiMethod:[{type:core.Input}],taList:[{type:core.Input}],taDebounce:[{type:core.Input}],taSelected:[{type:core.Output}],suggestionsTplRef:[{type:core.ViewChild,args:["suggestionsTplRef"]}],handleEsc:[{type:core.HostListener,args:["keydown",["$event"]]}],onkeyup:[{type:core.HostListener,args:["keyup",["$event"]]}]},NgxTypeAheadComponent}(),NgxTypeaheadModule=function(){function NgxTypeaheadModule(){}return NgxTypeaheadModule.decorators=[{type:core.NgModule,args:[{declarations:[NgxTypeAheadComponent],exports:[NgxTypeAheadComponent,common.CommonModule],imports:[common.CommonModule,http.HttpClientModule,http.HttpClientJsonpModule],providers:[]}]}],NgxTypeaheadModule}();exports.NgxTypeaheadModule=NgxTypeaheadModule,exports.Éµa=NgxTypeAheadComponent,Object.defineProperty(exports,"__esModule",{value:!0})});